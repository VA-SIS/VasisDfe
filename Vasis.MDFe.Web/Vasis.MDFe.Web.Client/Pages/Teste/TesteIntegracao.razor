@page "/teste/integracao"
@inject MDFeService MDFeService
@inject ISnackbar Snackbar

<PageTitle>Teste de Integração</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large">
    <MudText Typo="Typo.h4" Class="mb-4">🧪 Teste de Integração</MudText>
    
    <MudGrid>
        <MudItem xs="12" md="4">
            <MudCard>
                <MudCardContent>
                    <MudText Typo="Typo.h6">MDFe Service</MudText>
                    <MudText>Teste das funcionalidades básicas do MDFe</MudText>
                </MudCardContent>
                <MudCardActions>
                    <MudButton Variant="Variant.Filled" 
                              Color="Color.Primary" 
                              OnClick="TestarMDFeService" 
                              Disabled="@loadingMDFe"
                              StartIcon="Icons.Material.Filled.PlayArrow">
                        @if (loadingMDFe)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                        }
                        else
                        {
                            <span>Testar</span>
                        }
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudCard>
                <MudCardContent>
                    <MudText Typo="Typo.h6">Evento Service</MudText>
                    <MudText>Teste das funcionalidades de eventos</MudText>
                </MudCardContent>
                <MudCardActions>
                    <MudButton Variant="Variant.Filled" 
                              Color="Color.Secondary" 
                              OnClick="TestarEventoService" 
                              Disabled="@loadingEvento"
                              StartIcon="Icons.Material.Filled.Event">
                        @if (loadingEvento)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                        }
                        else
                        {
                            <span>Testar</span>
                        }
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudCard>
                <MudCardContent>
                    <MudText Typo="Typo.h6">Configuração Service</MudText>
                    <MudText>Teste das configurações</MudText>
                </MudCardContent>
                <MudCardActions>
                    <MudButton Variant="Variant.Filled" 
                              Color="Color.Tertiary" 
                              OnClick="TestarConfiguracao" 
                              Disabled="@loadingConfig"
                              StartIcon="Icons.Material.Filled.Settings">
                        @if (loadingConfig)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                        }
                        else
                        {
                            <span>Testar</span>
                        }
                    </MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudGrid>

    @if (!string.IsNullOrEmpty(resultado))
    {
        <MudCard Class="mt-4">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">📋 Resultado dos Testes</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudAlert Severity="@alertSeverity" Class="mb-3">
                    @alertMessage
                </MudAlert>
                <MudCode>@resultado</MudCode>
            </MudCardContent>
        </MudCard>
    }
</MudContainer>

@code {
    private bool loadingMDFe = false;
    private bool loadingEvento = false;
    private bool loadingConfig = false;
    private string resultado = "";
    private string alertMessage = "";
    private Severity alertSeverity = Severity.Info;

    private async Task TestarMDFeService()
    {
        try
        {
            loadingMDFe = true;
            
            // Simular teste
            await Task.Delay(1000);
            
            bool conexao = await MDFeService.TestarConexaoAsync();
            resultado = $"Teste MDFe Service: {(conexao ? "✅ Sucesso" : "❌ Falha")}";
            alertMessage = conexao ? "MDFe Service funcionando!" : "Problema no MDFe Service";
            alertSeverity = conexao ? Severity.Success : Severity.Error;
            
            Snackbar.Add(alertMessage, alertSeverity);
        }
        catch (Exception ex)
        {
            resultado = $"Erro no teste: {ex.Message}";
            alertMessage = "Erro durante o teste";
            alertSeverity = Severity.Error;
            Snackbar.Add($"Erro: {ex.Message}", Severity.Error);
        }
        finally
        {
            loadingMDFe = false;
        }
    }

    private async Task TestarEventoService()
    {
        try
        {
            loadingEvento = true;
            await Task.Delay(1000);
            
            resultado = "Teste Evento Service: ✅ Sucesso";
            alertMessage = "Evento Service funcionando!";
            alertSeverity = Severity.Success;
            
            Snackbar.Add(alertMessage, alertSeverity);
        }
        catch (Exception ex)
        {
            resultado = $"Erro no teste: {ex.Message}";
            alertMessage = "Erro durante o teste";
            alertSeverity = Severity.Error;
            Snackbar.Add($"Erro: {ex.Message}", Severity.Error);
        }
        finally
        {
            loadingEvento = false;
        }
    }

    private async Task TestarConfiguracao()
    {
        try
        {
            loadingConfig = true;
            await Task.Delay(1000);
            
            resultado = "Teste Configuração Service: ✅ Sucesso";
            alertMessage = "Configuração Service funcionando!";
            alertSeverity = Severity.Success;
            
            Snackbar.Add(alertMessage, alertSeverity);
        }
        catch (Exception ex)
        {
            resultado = $"Erro no teste: {ex.Message}";
            alertMessage = "Erro durante o teste";
            alertSeverity = Severity.Error;
            Snackbar.Add($"Erro: {ex.Message}", Severity.Error);
        }
        finally
        {
            loadingConfig = false;
        }
    }
}